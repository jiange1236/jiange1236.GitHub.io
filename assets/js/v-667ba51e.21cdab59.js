"use strict";(self.webpackChunkZeblog=self.webpackChunkZeblog||[]).push([[9923],{70774:(e,i,n)=>{n.r(i),n.d(i,{default:()=>d});var l=n(66252);const s=[(0,l.uE)('<h1 id="漏洞监控平台——monitor" tabindex="-1"><a class="header-anchor" href="#漏洞监控平台——monitor" aria-hidden="true">#</a> 漏洞监控平台——Monitor</h1><h2 id="写在前面的话" tabindex="-1"><a class="header-anchor" href="#写在前面的话" aria-hidden="true">#</a> <strong>写在前面的话</strong></h2><p>对于网络安全从业者来说，实时掌握漏洞动态是至关重要的，所以萌生了开发一个监控平台的想法，把最新漏洞资讯集成然后进行推送。这里推送选的是企业微信，留下了邮件推送的接口，默认是关闭的，想开启的小伙伴自行开启。数据库选用的是sqlite。目前实现了监控GitHub、微软、CNNVD。（不要问我为啥不监控CNVD，我是不会告诉你我干不过它的反爬【狗头保命】）。</p><h2 id="项目介绍" tabindex="-1"><a class="header-anchor" href="#项目介绍" aria-hidden="true">#</a> <strong>项目介绍</strong></h2><h3 id="项目目录结构" tabindex="-1"><a class="header-anchor" href="#项目目录结构" aria-hidden="true">#</a> 项目目录结构</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>│  cve_db.db\n│  monitor.py\n│  style.css\n│\n├─Functions\n│  ├─Commons\n│  │      excel.py\n│  │      excel_html.py\n│  │      github.py\n│  │      mail.py\n│  │      style.css\n│  │      translate.py\n│  │      wechat_api.py\n│  │      __init__.py\n│  │\n│  ├─RequestInfo\n│  │      cnnvd_monitor.py\n│  │      github_monitor.py\n│  │      MS_monitor.py\n│  │      __init__.py\n│  │\n│  └─Sql\n│          installDb.py\n│          sql_helper.py\n│\n└─log\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="文件说明" tabindex="-1"><a class="header-anchor" href="#文件说明" aria-hidden="true">#</a> 文件说明</h3><p><strong>monitor.py</strong>文件是主文件，部署完成后直接运行就此文件可以。</p><p><strong>Commons</strong>目录下的文件为主要功能文件。</p><p><strong>RequestInfo</strong>目录下为监控目标的一些文件。</p><p><strong>Sql</strong>目录下为数据库相关文件，installDb.py是用来生成数据库和日志文件的。</p><p><strong>log</strong>目录为存放日志文件目录。</p><h3 id="功能介绍" tabindex="-1"><a class="header-anchor" href="#功能介绍" aria-hidden="true">#</a> 功能介绍</h3><p>同时监控CNNVD、Github、微软官方的漏洞消息。</p><h4 id="cnnvd" tabindex="-1"><a class="header-anchor" href="#cnnvd" aria-hidden="true">#</a> CNNVD</h4><ul><li>每天推送企业微信卡片消息</li><li>Web端漏洞信息表格展示</li><li>每周五统计漏洞数量（高危、中危、低危）</li><li>高危漏洞信息醒目标注</li></ul><h4 id="微软官方漏洞消息" tabindex="-1"><a class="header-anchor" href="#微软官方漏洞消息" aria-hidden="true">#</a> 微软官方漏洞消息</h4><ul><li>每天推送企业微信卡片消息</li><li>Web端漏洞信息表格展示</li></ul><h4 id="github" tabindex="-1"><a class="header-anchor" href="#github" aria-hidden="true">#</a> Github</h4><ul><li>每天推送企业微信卡片消息</li><li>点击卡片消息自动跳转对应Github链接</li></ul><h4 id="展示效果" tabindex="-1"><a class="header-anchor" href="#展示效果" aria-hidden="true">#</a> 展示效果</h4><p>效果如下图</p><p><img src="https://cdn.jsdelivr.net/gh/jiange1236/MyImage/MdImg/640-164346328639935.webp" alt="图片">cve</p><p><strong>当点击CNNVD的消息卡片时，会跳转到相对应的Web端以表格形式展示</strong>，如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/jiange1236/MyImage/MdImg/640-164346328639936.webp" alt="图片">cnnvd</p><p><strong>点击微软漏洞消息的漏洞卡片时，也会跳转到相对应的Web端表格展示</strong>，如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/jiange1236/MyImage/MdImg/640-164346328639937.webp" alt="图片">微软</p><p><strong>点击Github的漏洞消息通知时，跳转到相对于的Github地址</strong>，如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/jiange1236/MyImage/MdImg/640-164346328639938.webp" alt="图片">github</p><h2 id="项目部署" tabindex="-1"><a class="header-anchor" href="#项目部署" aria-hidden="true">#</a> <strong>项目部署</strong></h2><h3 id="前期准备" tabindex="-1"><a class="header-anchor" href="#前期准备" aria-hidden="true">#</a> 前期准备</h3><ul><li>开发语言：python3</li><li>一台服务器(脚本跑在服务器上)</li><li>一个域名(可选)</li></ul><p>首先安装依赖，如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>import os\nimport time\nfrom io import BytesIO\nimport xlwt\nfrom xlrd import open_workbook\nimport datetime\nimport dominate\nfrom dominate.tag import *\nimport requests\nimport smtplib\nfrom email.mime.text import MIMEText\nfrom email.header import Header\nimport hashlib\nfrom lxml import etree\nimport json\nfrom bs4 import BeautifulSoup\nimport re\nimport sqlite3\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后进行数据库初始化，初始化时生成log文件夹用来存放生成的日志文件。命令如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>python3 installDb.py\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建" aria-hidden="true">#</a> 环境搭建</h3><p>因为要做Web端表格展示，所以这里<strong>使用Nginx做了目录浏览</strong>。服务器系统使用的是CentOS7，过程如下。</p><p>首先使用yum源下载nginx，命令如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum install -y nginx\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>装好后，查看版本，检查是否安装成功，如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/jiange1236/MyImage/MdImg/640-164346328639939.webp" alt="图片"></p><p>然后找到nginx的配置文件，具体位置为：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /etc/nginx/\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>找到nginx.conf文件，对其中的server板块进行修改就可以了，<strong>主要是添加了末尾三行</strong>。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>server {\n    listen       80;\n    listen       [::]:80;\n    server_name  _;\n   # root         /usr/share/nginx/html;\n    charset utf-8;\n    # Load configuration files for the default server block.\n    include /etc/nginx/default.d/*.conf;\n    location / {\n            root /usr/share/nginx/html/download;\n    autoindex on; #开启索引功能\n    autoindex_exact_size off; #关闭计算文件确切大小(bytes)\n    autoindex_localtime on; #显示本机时间\n}\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意生成文件位置</strong>，我这里是<code>/usr/share/nginx/html/download</code> ，看个人爱好。</p><p><strong>如果修改，请修改monitor.py的24行和excel_html.py的11行。</strong></p><p><img src="https://cdn.jsdelivr.net/gh/jiange1236/MyImage/MdImg/640-164346328640040.webp" alt="图片">image-20220122141836235</p><p><img src="https://cdn.jsdelivr.net/gh/jiange1236/MyImage/MdImg/640-164346328640041.webp" alt="图片">image-20220122142248502</p><h3 id="配置企业微信推送" tabindex="-1"><a class="header-anchor" href="#配置企业微信推送" aria-hidden="true">#</a> 配置企业微信推送</h3><p>这个需要先到企业微信创建一个企业，并自建一个应用，<strong>获取到自定义应用的 Secret和注册的企业 corpid</strong>，就可以了。修改位置在**wechat_api.py**文件****<strong>的14行至17行</strong>，如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/jiange1236/MyImage/MdImg/640-164346328640042.webp" alt="图片">image-20220122142707821</p><p>启动监控脚本，命令如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>python3 moniter.py\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>大功告成！！！</p>',56)],r={},d=(0,n(83744).Z)(r,[["render",function(e,i){return(0,l.wg)(),(0,l.iD)("div",null,s)}]])},83744:(e,i)=>{i.Z=(e,i)=>{const n=e.__vccOpts||e;for(const[e,l]of i)n[e]=l;return n}},89408:(e,i,n)=>{n.r(i),n.d(i,{data:()=>l});const l=JSON.parse('{"key":"v-667ba51e","path":"/others/%E6%BC%8F%E6%B4%9E%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0Monitor.html","title":"漏洞监控平台——Monitor","lang":"zh-CN","frontmatter":{"author":"jiange1236","title":"漏洞监控平台——Monitor","description":"漏洞监控平台——Monitor","date":"2022-02-11T00:00:00.000Z","category":"other","tag":"other","article":true,"timeline":true,"icon":null,"password":null},"excerpt":"","headers":[{"level":1,"title":"漏洞监控平台——Monitor","slug":"漏洞监控平台——monitor","children":[{"level":3,"title":"项目目录结构","slug":"项目目录结构","children":[]},{"level":3,"title":"文件说明","slug":"文件说明","children":[]},{"level":3,"title":"功能介绍","slug":"功能介绍","children":[]},{"level":3,"title":"前期准备","slug":"前期准备","children":[]},{"level":3,"title":"环境搭建","slug":"环境搭建","children":[]},{"level":3,"title":"配置企业微信推送","slug":"配置企业微信推送","children":[]}]}],"git":{"updatedTime":1652532191000,"contributors":[{"name":"jiange1236","email":"183465355@qq.com","commits":4}]},"filePathRelative":"others/漏洞监控平台Monitor.md"}')}}]);