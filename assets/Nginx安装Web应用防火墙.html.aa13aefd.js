import{e as n}from"./app.e05531d3.js";import{_ as a}from"./plugin-vue_export-helper.21dcd24c.js";const s={},e=n(`<h1 id="nginx\u5B89\u88C5web\u5E94\u7528\u9632\u706B\u5899" tabindex="-1"><a class="header-anchor" href="#nginx\u5B89\u88C5web\u5E94\u7528\u9632\u706B\u5899" aria-hidden="true">#</a> Nginx\u5B89\u88C5Web\u5E94\u7528\u9632\u706B\u5899</h1><p>LNMP\u4E00\u952E\u5B89\u88C5\u5305 ngx_lua_waf waf(web\u5E94\u7528\u9632\u706B\u5899) \u5B89\u88C5\u8BBE\u7F6E\u3002WAF\u4E2D\u6587\u540D\u662FWeb\u5E94\u7528\u9632\u706B\u5899\uFF0CWAF\u80FD\u591F\u6839\u636E\u89C4\u5219\u62E6\u622ASQL\u6CE8\u5165\u3001\u6076\u610F\u8BF7\u6C42\u3001\u9ED1\u5BA2\u626B\u63CF\u7B49HTTP\u8BF7\u6C42\u4ECE\u800C\u4FDD\u62A4WEB\u5E94\u7528\u7684\u5B89\u5168\u3002</p><p>\u4ECA\u5929\u6211\u4EEC\u8981\u8BF4\u7684\u662F\u4E00\u4E2A\u6BD4\u8F83\u7B80\u5355\u597D\u7528\u7684\u57FA\u4E8Elua\u7684waf\uFF1Angx_lua_waf\u3002\u5B83\u662F\u4E00\u4E2A\u57FA\u4E8Elua-nginx-module(openresty)\u7684web\u5E94\u7528\u9632\u706B\u5899\uFF0Chttps://github.com/loveshell/ngx_lua_waf\u3002</p><p>\u7528\u9014\uFF1A</p><ul><li>\u9632\u6B62sql\u6CE8\u5165\uFF0C\u672C\u5730\u5305\u542B\uFF0C\u90E8\u5206\u6EA2\u51FA\uFF0Cfuzzing\u6D4B\u8BD5\uFF0Cxss\uFF0CSSRF\u7B49web\u653B\u51FB</li><li>\u9632\u6B62svn/\u5907\u4EFD\u4E4B\u7C7B\u6587\u4EF6\u6CC4\u6F0F</li><li>\u9632\u6B62ApacheBench\u4E4B\u7C7B\u538B\u529B\u6D4B\u8BD5\u5DE5\u5177\u7684\u653B\u51FB</li><li>\u5C4F\u853D\u5E38\u89C1\u7684\u626B\u63CF\u9ED1\u5BA2\u5DE5\u5177\uFF0C\u626B\u63CF\u5668</li><li>\u5C4F\u853D\u5F02\u5E38\u7684\u7F51\u7EDC\u8BF7\u6C42</li><li>\u5C4F\u853D\u56FE\u7247\u9644\u4EF6\u7C7B\u76EE\u5F55php\u6267\u884C\u6743\u9650</li><li>\u9632\u6B62webshell\u4E0A\u4F20</li></ul><h2 id="ngx-lua-waf\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#ngx-lua-waf\u5B89\u88C5" aria-hidden="true">#</a> ngx_lua_waf\u5B89\u88C5</h2><h3 id="_1-lua\u652F\u6301\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#_1-lua\u652F\u6301\u5B89\u88C5" aria-hidden="true">#</a> 1. lua\u652F\u6301\u5B89\u88C5</h3><p>LNMP\u4E00\u952E\u5B89\u88C5\u5305\u4ECE1.5\u5F00\u59CB\u589E\u52A0\u4E86lua\u652F\u6301\u7684\u9009\u9879\uFF0C\u53EF\u4EE5\u901A\u8FC7\u4FEE\u6539lnmp.conf\u4E2DEnable_Nginx_Lua\u540E\u7684\u53C2\u6570\u4E3A y \u6765\u542F\u7528lua\uFF0C\u5982\u679C\u6CA1\u5B89\u88C5lnmp\uFF0C\u4FEE\u6539lnmp.conf\u540E\u4FDD\u5B58\uFF0C\u5B89\u88C5\u5B8Clnmp\u5C31\u662F\u652F\u6301lua\u7684\uFF0C\u5982\u679C\u5DF2\u7ECF\u5B89\u88C5\u597Dlnmp\uFF0C\u4E5F\u662F\u6309\u524D\u9762\u4FEE\u6539lnmp.conf</p><p>\u7136\u540Elnmp\u5B89\u88C5\u5305\u76EE\u5F55\u4E0B\u8FD0\u884C<code>./upgrade.sh nginx</code> \u5347\u7EA7nginx</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>./upgrade.sh nginx
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u8F93\u5165\u5F53\u524Dnginx\u7248\u672C\u53F7\u6216\u66F4\u65B0\u7684nginx\u7248\u672C\u53F7\uFF0C\u5347\u7EA7\u5B8C\u6210\u5C31\u662F\u652F\u6301lua\u7684\u4E86\u3002\u5982\u679C\u51FA\u9519\uFF0C\u8BF7\u91CD\u65B0\u4E0B\u8F7D\u5B8C\u6574\u7248\u7684LNMP\u5B89\u88C5\u5305lnmp**-full.tar.gz\uFF0C\u518D\u6B21\u5B89\u88C5\u3002</p><h3 id="_2-\u5B89\u88C5ngx-lua-waf" tabindex="-1"><a class="header-anchor" href="#_2-\u5B89\u88C5ngx-lua-waf" aria-hidden="true">#</a> 2. \u5B89\u88C5ngx_lua_waf</h3><p>\u4E0B\u8F7D\u5B89\u88C5ngx_lua_waf\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>wget https://github.com/loveshell/ngx_lua_waf/archive/master.zip -O ngx_lua_waf.zip
unzip ngx_lua_waf.zip
mv ngx_lua_waf-master /usr/local/nginx/conf/waf
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>nginx\u4E0A\u8BBE\u7F6E\u5E76\u542F\u7528ngx_lua_waf</p><p>\u7F16\u8F91 <code>/usr/local/nginx/conf/nginx.conf </code>\u5728<strong>http\u6BB5</strong>\u7684 <code>server_tokens off</code>; \u4E0B\u9762\u6DFB\u52A0\u5982\u4E0B\u4EE3\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>lua_package_path &quot;/usr/local/nginx/conf/waf/?.lua&quot;;
lua_shared_dict limit 10m;
init_by_lua_file /usr/local/nginx/conf/waf/init.lua;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u4FEE\u6539\u5B8C\u6210\u4FDD\u5B58</p><p>\u5982\u679C\u8981\u60F3\u5728\u67D0\u4E2A\u865A\u62DF\u4E3B\u673A\u542F\u7528ngx_lua_waf\u53EF\u4EE5\u4FEE\u6539\u5BF9\u5E94\u865A\u62DF\u4E3B\u673A\u7684server\u6BB5\uFF0C\u5728\u8BE5server\u6BB5\u4E2D root \u7F51\u7AD9\u76EE\u5F55\u884C\u4E0B\u9762\u6DFB\u52A0\u5982\u4E0B\u4EE3\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>access_by_lua_file /usr/local/nginx/conf/waf/waf.lua;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u4FEE\u6539\u5B8C\u6210\u4FDD\u5B58</p><p>\u6D4B\u8BD5nginx\u914D\u7F6E\u6587\u4EF6\uFF1A<code>/usr/local/nginx/sbin/nginx -t</code> \u91CD\u8F7Dnginx\u914D\u7F6E\u751F\u6548\uFF1A<code>/usr/local/nginx/sbin/nginx -s reload</code></p><p>\u5982\u679C\u6D4B\u8BD5\u548C\u91CD\u8F7D\u90FD\u6CA1\u62A5\u9519\u5C31\u5DF2\u7ECF\u751F\u6548\u3002</p><p>\u53EF\u4EE5\u901A\u8FC7\u8BBF\u95EE http://\u57DF\u540D/test.php?id=../etc/passwd \u6765\u6D4B\u8BD5</p><p>\u63D0\u793A\uFF1A\u60A8\u7684\u8BF7\u6C42\u5E26\u6709&gt;\u4E0D\u5408\u6CD5\u53C2\u6570\uFF0C\u5DF2\u88AB\u7F51\u7AD9\u7BA1\u7406\u5458\u8BBE\u7F6E\u62E6\u622A\uFF01\u8BF4\u660E\u5DF2\u7ECF\u6B63\u786E\u8BBE\u7F6E</p><h3 id="_3-ngx-lua-waf\u9632\u706B\u5899\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_3-ngx-lua-waf\u9632\u706B\u5899\u914D\u7F6E" aria-hidden="true">#</a> 3. ngx_lua_waf\u9632\u706B\u5899\u914D\u7F6E</h3><p>ngx_lua_waf\u914D\u7F6E\u6587\u4EF6\u4F4D\u7F6E\uFF1A<code>/usr/local/nginx/conf/waf/config.lua</code> ngx_lua_waf\u914D\u7F6E\u6587\u4EF6\u53C2\u6570\u8BF4\u660E\uFF1A</p><div class="language-lua ext-lua line-numbers-mode"><pre class="language-lua"><code>RulePath <span class="token operator">=</span> \u201C<span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">local</span><span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token operator">/</span>waf<span class="token operator">/</span>wafconf<span class="token operator">/</span>\u201D
\u2013\u89C4\u5219\u5B58\u653E\u76EE\u5F55
attacklog <span class="token operator">=</span> \u201Coff\u201D
\u2013\u662F\u5426\u5F00\u542F\u653B\u51FB\u4FE1\u606F\u8BB0\u5F55\uFF0C\u9700\u8981\u914D\u7F6Elogdir
logdir <span class="token operator">=</span> \u201C<span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">local</span><span class="token operator">/</span>nginx<span class="token operator">/</span>logs<span class="token operator">/</span>hack<span class="token operator">/</span>\u201D
\u2013log\u5B58\u50A8\u76EE\u5F55\uFF0C\u8BE5\u76EE\u5F55\u9700\u8981\u7528\u6237\u81EA\u5DF1\u65B0\u5EFA\uFF0C\u5207\u9700\u8981nginx\u7528\u6237\u7684\u53EF\u5199\u6743\u9650
UrlDeny<span class="token operator">=</span>\u201Don\u201D
\u2013\u662F\u5426\u62E6\u622Aurl\u8BBF\u95EE
Redirect<span class="token operator">=</span>\u201Don\u201D
\u2013\u662F\u5426\u62E6\u622A\u540E\u91CD\u5B9A\u5411
CookieMatch <span class="token operator">=</span> \u201Con\u201D
\u2013\u662F\u5426\u62E6\u622Acookie\u653B\u51FB
postMatch <span class="token operator">=</span> \u201Con\u201D
\u2013\u662F\u5426\u62E6\u622Apost\u653B\u51FB
whiteModule <span class="token operator">=</span> \u201Con\u201D
\u2013\u662F\u5426\u5F00\u542FURL\u767D\u540D\u5355
black_fileExt<span class="token operator">=</span><span class="token punctuation">{</span>\u201Cphp\u201D<span class="token punctuation">,</span>\u201Djsp\u201D<span class="token punctuation">}</span>
\u2013\u586B\u5199\u4E0D\u5141\u8BB8\u4E0A\u4F20\u6587\u4EF6\u540E\u7F00\u7C7B\u578B
ipWhitelist<span class="token operator">=</span><span class="token punctuation">{</span>\u201C<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>\u201D<span class="token punctuation">}</span>
\u2013ip\u767D\u540D\u5355\uFF0C\u591A\u4E2Aip\u7528\u9017\u53F7\u5206\u9694
ipBlocklist<span class="token operator">=</span><span class="token punctuation">{</span>\u201C<span class="token number">1.0</span><span class="token number">.0</span><span class="token number">.1</span>\u2033<span class="token punctuation">}</span>
\u2013ip\u9ED1\u540D\u5355\uFF0C\u591A\u4E2Aip\u7528\u9017\u53F7\u5206\u9694
CCDeny<span class="token operator">=</span>\u201Don\u201D
\u2013\u662F\u5426\u5F00\u542F\u62E6\u622Acc\u653B\u51FB<span class="token punctuation">(</span>\u9700\u8981nginx<span class="token punctuation">.</span>conf\u7684http\u6BB5\u589E\u52A0lua_shared_dict limit 10m<span class="token punctuation">;</span><span class="token punctuation">)</span>
CCrate <span class="token operator">=</span> \u201C<span class="token number">100</span><span class="token operator">/</span><span class="token number">60</span>\u201D
\u2013\u8BBE\u7F6Ecc\u653B\u51FB\u9891\u7387\uFF0C\u5355\u4F4D\u4E3A\u79D2<span class="token punctuation">.</span>
\u2013\u9ED8\u8BA4<span class="token number">1</span>\u5206\u949F\u540C\u4E00\u4E2AIP\u53EA\u80FD\u8BF7\u6C42\u540C\u4E00\u4E2A\u5730\u5740<span class="token number">100</span>\u6B21
html<span class="token operator">=</span><span class="token string">[[Please go away~~]]</span> \u2013\u8B66\u544A\u5185\u5BB9<span class="token punctuation">,</span>\u53EF\u5728\u4E2D\u62EC\u53F7\u5185\u81EA\u5B9A\u4E49
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>\u5907\u6CE8:\u4E0D\u8981\u4E71\u52A8\u53CC\u5F15\u53F7\uFF0C\u533A\u5206\u5927\u5C0F\u5199</p><p>ngx_lua_waf\u5B89\u88C5\u5230\u6B64\u7ED3\u675F\u3002</p><h3 id="_4-ngx-lua-waf\u6548\u679C\u56FE" tabindex="-1"><a class="header-anchor" href="#_4-ngx-lua-waf\u6548\u679C\u56FE" aria-hidden="true">#</a> 4. ngx_lua_waf\u6548\u679C\u56FE</h3><p><img src="https://cdn.jsdelivr.net/gh/jiange1236/MyImage/MdImg/ngcb15.jpg" alt="ngx_lua_waf waf(web\u5E94\u7528\u9632\u706B\u5899)" loading="lazy"><img src="https://cdn.jsdelivr.net/gh/jiange1236/MyImage/MdImg/ngcb15-16419157753881.jpg" alt="ngx_lua_waf waf(web\u5E94\u7528\u9632\u706B\u5899)" loading="lazy"></p>`,32);function p(l,r){return e}var c=a(s,[["render",p],["__file","Nginx\u5B89\u88C5Web\u5E94\u7528\u9632\u706B\u5899.html.vue"]]);export{c as default};
